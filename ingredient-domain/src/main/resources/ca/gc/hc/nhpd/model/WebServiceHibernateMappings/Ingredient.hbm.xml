<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC 
	"-//Hibernate/Hibernate Mapping DTD 3.6//EN"
	"http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">

<hibernate-mapping package="ca.gc.hc.nhpd.model">
    <!-- Note that lazy must be turned off for the subclassing to create proper class signatures -->
    <class name="Ingredient" table="ingredients" lazy="false">
		<id name="id" type="java.lang.Long" column="ingred_id">
		    <generator class="assigned"/>
		</id>
        <discriminator column="ingredspec_class_name" type="string"/>
        <property name="commentE" type="string" length="1000" column="ingred_comment_eng"/>
        <property name="commentF" type="string" length="1000" column="ingred_comment_fr"/>
        <property name="descriptionE" type="string" length="1000" column="ingred_desc_eng"/>
        <property name="descriptionF" type="string" length="1000" column="ingred_desc_fr"/>
        <property name="quantityLowerTolerance" type="java.lang.Double" column="ingred_lower_tolerance"/>
        <property name="quantityUpperTolerance" type="java.lang.Double" column="ingred_upper_tolerance"/>
        <many-to-one name="category" column="ingredcat_id" not-null="true"/>
        <many-to-one name="source" column="ingredsrc_id" not-null="false"/>
        <set name="chemicalSubstances" sort="natural"
             table="ingredient_ingred_impurities">
            <key column="ingred_id"/>
            <many-to-many column="ingred_id_impur" class="Ingredient"/>
        </set>
        <set name="chemicalImpuritySubstances" sort="natural"
             table="ingredient_impurities">
            <key column="ingred_id"/>
            <many-to-many column="impurity_id" class="ImpuritySubstance"/>
        </set>
        <set name="properNames" sort="natural" table="ingredient_qualsyno_pns" lazy="false">
            <key column="ingred_id"/>
            <many-to-many column="qualsyno_id" unique="true" class="QualifiedSynonym"/>
        </set>
        <set name="commonNames" sort="natural" table="ingredient_qualsyno_cns" lazy="false">
            <key column="ingred_id"/>
            <many-to-many column="qualsyno_id" unique="true" class="QualifiedSynonym"/>
        </set>
        <set name="qualifiedSynonyms" sort="natural" table="ingredient_qualsyno_qss" lazy="false">
            <key column="ingred_id"/>
            <many-to-many column="qualsyno_id" unique="true" class="QualifiedSynonym"/>
        </set>
        <set name="microbiologicalImpurities" sort="natural" table="ingredient_bio_impurities" cascade="all">
            <key column="ingred_id"/>
            <many-to-many column="bioimpurity_id" unique="true" class="MicrobiologicalImpurity"/>
        </set>
        <!-- 
        <set name="monographEntries" sort="natural" table="monograph_entries">
            <key column="ingred_id"/>
            <one-to-many class="MonographEntry"/>
        </set> 
        -->       
        <set name="nhpClassifications" sort="natural"
             table="ingredient_nhpclassifications">
            <key column="ingred_id"/>
            <many-to-many column="nhpclass_id" class="NhpClassification"/>
        </set>
        <set name="roles" sort="natural" table="ingredient_roles" cascade="all">
            <key column="ingred_id"/>
            <one-to-many class="IngredientRole"/>
        </set>
        <map name="dosageFormGroupTestSpecMap" table="ingredient_test_specs">
            <key column="ingred_id"/>
            <map-key-many-to-many column="dosefrmgrp_id" class="DosageFormGroup"/>
            <many-to-many column="testspec_id" class="TestSpecification"/>
        </map>
        <set name="subIngredients" sort="natural" table="ingredient_subingredients" cascade="all">
	        <key column="ingred_id"/>
	        <many-to-many column="subingred_id" unique="false" class="SubIngredient"/>
	    </set>
        <property name="creationDate" type="date" column="ingred_creation_date"/>
        <property name="lastUpdateDate" type="date" column="ingred_lastupdate_date"/>
        <many-to-one name="lastUpdateAccount" lazy="false" column="useracc_id"/>
        
        <subclass name="ChemicalSubstance" discriminator-value="ChemicalSubstance">
        	<property name="groupAsString" type="string" length="1" column="ingred_group_flag"/>
            <property name="authorizedNameE" type="string" length="200" column="ingred_authorized_name_eng"/>
            <property name="authorizedNameF" type="string" length="200" column="ingred_authorized_name_fr"/>
            <property name="smilesNotation" type="string" length="1000" column="ingred_smiles_notation"/>
            <many-to-one name="casEntry" column="regentry_id"/>
            <many-to-one name="chemicalSubclass" column="chemsub_id"/>
            <many-to-one name="image" column="attachment_id"/>
            <many-to-one name="reference" column="ref_id" not-null="true"/>
            <many-to-one name="toxicityRestriction" column="restrict_id"/>
            
            <set name="otherRegistryEntries" sort="natural" table="ingredient_reg_entries" cascade="all">
                <key column="ingred_id"/>
                <many-to-many column="regentry_id" unique="true" class="RegistryEntry"/>
            </set>
            <set name="purityTestMethods" sort="natural" table="ingredient_test_methods">
                <key column="ingred_id"/>
                <many-to-many column="testmethod_id" class="TestMethod"/>
            </set>
              
            <set name="standardGradeReferences" sort="natural" table="ingredient_std_grade_refs">
                <key column="ingred_id"/>
                <many-to-many column="ref_id" unique="false" class="Reference"/>
            </set>
        </subclass>
        
        <subclass name="CustomOrganismSubstance" discriminator-value="CustomOrganismSubstance">
            <many-to-one name="organism" column="organism_id" not-null="true"/>
            <many-to-one name="part" column="orgpart_id" not-null="true"/>
            <many-to-one name="preparation" column="preptype_id" not-null="true"/>
        </subclass>

        <subclass name="DefinedOrganismSubstance" discriminator-value="DefinedOrganismSubstance">
            <property name="authorizedNameE" type="string" length="200" column="ingred_authorized_name_eng"/>
            <property name="authorizedNameF" type="string" length="200" column="ingred_authorized_name_fr"/>
            <many-to-one name="reference" column="ref_id" not-null="true"/>
            <many-to-one name="organismGroup" column="org_grp_id" not-null="false" lazy="false"/>
            <set name="parts" sort="natural" table="ingredient_orgparts" lazy="false" cascade="all">
                <key column="ingred_id"/>
                <many-to-many column="orgpart_id" class="OrganismPart"/>
            </set>
            <set name="preparations" sort="natural" table="ingredient_preptypes">
                <key column="ingred_id"/>
                <many-to-many column="preptype_id" class="PreparationType"/>
            </set>
            <set name="standardGradeReferences" sort="natural" table="ingredient_std_grade_refs">
              <key column="ingred_id"/>
              <many-to-many column="ref_id" unique="false" class="Reference"/>
            </set>
        </subclass>

        <subclass name="HomeopathicSubstance" discriminator-value="HomeopathicSubstance">
        
            <property name="authorizedNameE" type="string" length="200" column="ingred_authorized_name_eng"/>
            <property name="authorizedNameF" type="string" length="200" column="ingred_authorized_name_fr"/>
            
            <many-to-one name="reference" column="ref_id" not-null="true"/>
            
            <set name="homeopathicCommonNames" sort="natural" table="homeopathic_common_name_hgts">
              <key column="ingred_id"/>
              <many-to-many column="homeogentext_id" unique="true" class="HomeopathicGenericText"/>
            </set> 

            <set name="homeopathicProperNames" sort="natural" table="homeopathic_proper_name_hgts">
              <key column="ingred_id"/>
              <many-to-many column="homeogentext_id" unique="true" class="HomeopathicGenericText"/>
            </set> 
    
        </subclass>
    </class>
        
</hibernate-mapping>