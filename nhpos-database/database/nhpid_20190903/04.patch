--04.patch
--author:  Ramy Ghonaim
--date:    09/12/2019
--ticket:  DB-147 WPLA-305

CREATE OR REPLACE FORCE VIEW V_ASSESSMENT_DOSE_DFU as (
  select distinct x.dfu_id,
    ad.assessment_dose_id,
    ad.mono_code,
    ad.product_mono_code,
    ad.single_mono_code,
    ad.qdu_min ,
    ad.qdu_max ,
    ad.qie_min ,
    ad.qie_max ,
    ad.min_freq ,
    ad.max_freq ,
    ad.ratio_min ,
    ad.ratio_max ,
    ad.mi_dose_type,
    sp.dfu_group_code,
    case
      when sp.unique_dfu_code is null
      then sp.dfu_group_code
      else sp.unique_dfu_code
      end as unique_dfu_code,
    case
      when sp.unique_dfu_decode is null
      then sp.dfu_group_decode_eng
      else sp.unique_dfu_decode
      end as dfu_group_decode_eng,
    case
      when sp.unique_dfu_decode_fr is null
      then sp.dfu_group_decode_fr
      else sp.unique_dfu_decode_fr
      end as dfu_group_decode_fr,
    sp.dfu_type
  from x$assessment_dose_dfu x,
    v_assessment_doses ad,
    x$dfu_xref sp
  where x.assessment_dose_id = ad.assessment_dose_id
    and x.dfu_id = sp.dfu_id);
--
grant select on V_ASSESSMENT_DOSE_DFU to nhpdweb_user;
--
create or replace synonym nhpdweb_user.V_ASSESSMENT_DOSE_DFU for V_ASSESSMENT_DOSE_DFU;
