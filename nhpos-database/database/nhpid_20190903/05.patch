--05.patch
--author:  Ramy Ghonaim
--date:    09/12/2019
--ticket:  DB-150 WPLA-305

create or replace force view v_mono_ingredient_uses as (
select t.mono_code, d.ingredient_id, d.ingred_name_eng, t.use_code, t.use_decode_eng, t.use_decode_fr
  from v_assessment_doses d,
       v_assessment_dose_use t
  where d.assessment_dose_id = t.assessment_dose_id
    and d.ingredient_id not in (select subingredient_id from v_mono_subingreds)
union
select t2.mono_code, s.ingred_id ingredient_id, s.ingred_nhpid_name, t2.use_code, t2.use_decode_eng, t2.use_decode_fr
  from v_mono_subingreds s,
       v_assessment_doses d2,
       v_assessment_dose_use t2
where s.subingredient_id = d2.ingredient_id
   and s.mono_code = d2.mono_code
   and t2.assessment_dose_id = d2.assessment_dose_id
);
--
create public synonym v_mono_ingredient_uses for nhpdweb_owner.v_mono_ingredient_uses;
--
grant select on v_mono_ingredient_uses to public;